---
title: Setup
---

You can self-host Briefkasten with Docker and docker-compose. The setup is split into two docker-compose files, depending on how much you want to self-host, and how many cloud services you'd like to use.

1. [`docker-compose.yml`](https://github.com/ndom91/sveltekasten/blob/main/docker-compose.yml) - Contains the frontend and backend of the application.
2. [`docker-compose.storage.yml`](https://github.com/ndom91/sveltekasten/blob/main/docker-compose.storage.yml) - Contains a PostgreSQL container as well as a Minio object store container.

## Quick Start

<Steps>
<Step>

Clone the repository to your server.

```bash
git clone https://github.com/ndom91/sveltekasten.git
```

</Step>
<Step>

2. Setup the environment variables.

Make a copy of the two `.env.example` files and fill in at least the below minimum required variables with your favorite text editor. The example files have annotations for the variables.

1. `apps/web/.env.example`
2. `apps/backend/.env.example`

| Directory     | Variable       | Value                                                                   |
| :------------ | :------------- | :---------------------------------------------------------------------- |
| Web + Backend | `DATABASE_URL` | `postgres://username:password@localhost:5432/postgres`                  |
| Web           | `AUTH_URL`     | Your current URL (i.e. `http://localhost:3000`)                         |
| Web           | `AUTH_SECRET`  | Set to the output of `openssl rand -hex 33`                             |
| Web           | `WORKER_URL`   | URL of the `backend` application, (i.e. `http://localhost:8000/api/v0`) |
| Backend       | `JWT_SECRET`   | The same secret as you set in your web's `AUTH_SECRET`                  |

Next, you'll want to setup at least 1 [Authentication Provider](https://authjs.dev) with Auth.js-related environment variables. We support OAuth providers like Github, Google, Azure, Keycloak and Authentik as well as the Email "Magic Link" provider out of the box. See the `apps/web/.env.example` for the various environment variables you can set.

For example, the [GitHub provider](https://authjs-nextra-docs.vercel.app/getting-started/providers/github) is easy to setup and safe to use. That requires the `AUTH_GITHUB_ID` and `AUTH_GITHUB_SECRET` environment variables to be set.

</Step>
<Step>

If you want to use the storage containers, you'll want to change some of the default credentials in the `docker-compose.storage.yml` file. For more details, check out the [Object Storage](#object-storage) and [Database](#database) sections below.

</Step>
<Step>

Finally, you can spin up the containers

<Tabs items={['Application', 'Application + Storage']}>
  <Tab value="Application">

To start only the application containers (`sveltekasten-web` and `sveltekasten-backend`), you can use the following command in the root of the repository. It will default to only using the primary `docker-compose.yml`.

```bash
docker-compose up -d
```

  </Tab>
  <Tab value="Application + Storage">

To start the application containers (`database` and `minio`/`mc`) as well, you can use the following command in the root of the repository.

```bash
docker-compose -f docker-compose.yml -f docker-compose.storage.yml up -d
```

  </Tab>
</Tabs>

</Step>
<Step>

Now your application should be up and running at the default `http://localhost:3000`

You can continue by putting `localhost:3000` behind a reverse proxy, like `nginx` or `traefik` for example.

<Accordions>
<Accordion title="Example nginx config">

This includes some `include` files generated by [LetsEncrypt](https://letsencrypt.org)&apos;s `certbot` tool. For more info, check out their [docs](https://certbot.eff.org). If you don&apos;t want to use `certbot`, just remove any lines that contain `letsencrypt` below. Don&apos;t forget to generate and use an SSL certificate in another way then though!

```nginx title="briefkasten.conf"
server {
    listen 80;
    server_name app.company.com;

    if ($host = app.company.com) {
        return 301 https://$host$request_uri;
    }
}

server {
    listen 443 ssl http2;
    server_name app.company.com;

    gzip on;
    gzip_vary on;
    gzip_min_length 1000;
    gzip_proxied any;
    gzip_types text/plain text/css text/xml application/xml text/javascript application/x-javascript image/svg+xml;
    gzip_disable "MSIE [1-6]\.";

    add_header X-XSS-Protection "1; mode=block";
    add_header X-Content-Type-Options "nosniff";

    location / {
        proxy_pass http://10.0.1.2:3000;

        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";

        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Forwarded-Protocol $scheme;
        proxy_set_header X-Forwarded-Server $host;
        proxy_set_header X-Forwarded-Host $http_host;
    }

    location /api/v0 {
        proxy_pass http://10.0.1.2:8000;

        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Forwarded-Protocol $scheme;
        proxy_set_header X-Forwarded-Server $host;
        proxy_set_header X-Forwarded-Host $http_host;
    }

    error_log /var/log/nginx/briefkasten.error.log info;
    access_log /var/log/nginx/briefkasten.access.log;

    ssl_certificate /etc/letsencrypt/live/app.company.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/app.company.com/privkey.pem;
    ssl_stapling on;
    ssl_stapling_verify on;

    include /etc/letsencrypt/options-ssl-nginx.conf;
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;
}
```

</Accordion>
</Accordions>

</Step>
</Steps>

## Details

### Database

To setup the PostgreSQL database, checkout out the `database` service in the `docker-compose.storage.yml` file. We can bring up that database separately with the following command.

```bash
docker-compose -f docker-compose.storage.yml up database
```

If you're running the application with their `sveltekasten-web` and `sveltekasten-backend` containers from the `docker-compose.yml` file, they will automatically apply the initial schema migrations to the database upon startup. Otherwise, checkout the [development -> database](/docs/development#database) section for more information on how to run the migrations manually.

After you've setup the database, you'll need to tell the web and backend applications where to find the database. This is done by setting the required `DATABASE_URL` environment variable in both the `apps/web/.env` and `apps/backend/.env` files. This default connection string should work if your applications are running in containers on the same docker network as the database, otherwise you&aposll need to adjust at least the hostname (`database`).

```bash title="/apps/web/.env"
DATABASE_URL=postgres://postgres:postgres@database:5432/briefkasten
```

### Object Storage

The default object storage provider is [Cloudflare R2](https://www.cloudflare.com/developer-platform/r2/) as it has a generous free plan with 10GB storage and no egress fees. But if you'd like to self-host this service, we&apos;ve included a [minio](https://min.io) container setup in the `docker-compose.storage.yml` file.

You can start it separately with the following command. Make sure to update the `MINIO_ROOT_USER` and `MINIO_ROOT_PASSWORD` environment variables in the `docker-compose.storage.yml` file, these will be your bucket access key and secret key, respectively, as well as the login for the minio console (available at the container&apos;s port `9001`).

```bash
docker-compose -f docker-compose.storage.yml up mc minio
```

When using the minio container, make sure to update the `BUCKET_*` related environment variables in the backend `apps/backend/.env` file. For example, when using the default minio settings, the following environment variables should work.

```bash title="/apps/backend/.env"
BUCKET_NAME=briefkasten
BUCKET_ACCESS_KEY=AKIAIOSFODNN7EXAMPLE
BUCKET_SECRET_KEY=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
BUCKET_URL="http://minio:9000/${BUCKET_NAME}"
```

Don&apos;t forget to update the access key and secret key based on what you updated in the `docker-compose.storage.yml` definition. Also you may need to update the hostname (`minio`) in the `BUCKET_URL`, if your instance of the `sveltekasten-backend` is not running in a container on the same docker network as the minio container. If your `sveltekasten-backend` is not running on the same docker network, you'll have to update this to the IP address or full hostname of the minio container.
